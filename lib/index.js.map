{"version":3,"sources":["webpack://stocache/webpack/universalModuleDefinition","webpack://stocache/./src/index.js","webpack://stocache/webpack/bootstrap","webpack://stocache/webpack/startup"],"names":["root","factory","exports","module","define","amd","self","this","config","support","key","window","setItem","JSON","stringify","parse","getItem","e","scope","storageType","exception","generator","value","input","code","i","length","charCodeAt","Math","abs","name","message","json","encode","fallback","decode","storage","set","unset","removeItem","get","middleware","now","floor","Date","keys","shadow","context","clean","flush","expireSoon","changed","expireSoonKey","expireSoonKTime","Object","closestItem","keep","ttl","condition","has","parseInt","writed","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__"],"mappings":"CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,WAAY,GAAIH,GACG,iBAAZC,QACdA,QAAkB,SAAID,IAEtBD,EAAe,SAAIC,IARrB,CASmB,oBAATK,KAAuBA,KAAOC,MAAM,WAC9C,O,iDCVA,IAAMC,EACK,WADLA,EAEG,KAFHA,GAGS,EAHTA,EAIW,eAGXC,EAAW,SAACC,GACd,IAEI,OADAC,OAAOH,GAAoBI,QAAQF,EAAKG,KAAKC,WAAU,IAChDD,KAAKE,MAAMJ,OAAOH,GAAoBQ,QAAQN,IACvD,MAAOO,GACL,OAAO,GALE,CAOdT,cAgKH,UA9JiB,SAACU,EAAsBC,EAAkCC,QAAiC,IAAzFF,MAAQV,QAAiF,IAAnEW,MAAcX,QAAqD,IAAjCY,MAAYZ,GAClF,IAAMa,EAAY,SAACH,GAAD,MAAY,CAC1BR,IAAK,SAACY,QAAkB,IAAlBA,MAAQJ,GAGV,IAFA,IAAIK,EAAkB,OAAVD,EAAiBJ,EAAQI,EACjCE,EAAO,EACFC,EAAI,EAAGA,EAAIF,EAAMG,OAAQD,IAC9BD,GAAQA,GAAQ,GAAKA,EAAOD,EAAMI,WAAWF,GAC7CD,GAAcA,EAElB,OAAON,EAAQ,KAAOM,EAAO,EAAIA,EAAO,IAAMI,KAAKC,IAAIL,KAE3DJ,UAAW,SAACU,EAAaC,GAAd,gBAACD,MAAO,WAAR,IAAcC,MAAU,MAAU,CACzCb,QACAY,OACAC,cAIFC,EAAO,SAACV,GAAD,MAAY,CACrBW,OAAQ,SAACC,QAAkB,IAAlBA,MAAW,IAChB,IACI,OAAOrB,KAAKC,UAAUQ,GACxB,MAAO,GAAa,IAAXS,EAAW,EAAXA,QACP,GAAIX,EAAW,MAAMC,EAAUH,GAAOE,UAAU,cAAeW,GAC/D,OAAOG,IAGfC,OAAQ,SAACD,QAAkB,IAAlBA,MAAW,IAChB,IACI,OAAOrB,KAAKE,MAAMO,GACpB,MAAO,GAAa,IAAXS,EAAW,EAAXA,QACP,GAAIX,EAAW,MAAMC,EAAUH,GAAOE,UAAU,cAAeW,GAC/D,OAAOG,MAKbE,EAAU,SAAC1B,GAAD,gBAACA,MAAMQ,GAAW,CAC9BmB,IAAK,SAACf,QAAiB,IAAjBA,MAAQ,MACV,IAEI,OADAX,OAAOQ,GAAaP,QAAQF,EAAKsB,EAAKV,GAAOW,WACtC,EACT,MAAO,GAAa,IAAXF,EAAW,EAAXA,QACP,GAAIX,EAAW,MAAMC,EAAUH,GAAOE,UAAU,cAAeW,GAC/D,OAAO,IAGfO,MAAO,WACH,IAEI,OADA3B,OAAOQ,GAAaoB,WAAW7B,IACxB,EACT,MAAO,GAAa,IAAXqB,EAAW,EAAXA,QACP,GAAIX,EAAW,MAAMC,EAAUH,GAAOE,UAAU,gBAAiBW,GACjE,OAAO,IAGfS,IAAK,SAACN,GACF,YADuB,IAArBA,OAAW,GACNF,EAAKrB,OAAOQ,GAAaH,QAAQN,IAAMyB,OAAOD,MAIvDO,EAAa,SAAC/B,EAAagC,QAAwC,IAArDhC,MAAMQ,QAA+C,IAAxCwB,MAAMd,KAAKe,MAAMC,KAAKF,MAAQ,MAC3D,IAAIG,EAAO,CACPC,OAAQzB,EAAUH,GAAOR,MACzB0B,QAASf,EAAUH,GAAOR,IAAIA,IAE9BqC,EAAUX,EAAQS,EAAKC,QAAQN,OAAS,GAStCF,EAAQ,SAAC5B,GACX,QAAID,WACOsC,EAAQrC,GACR0B,EAAQ1B,GAAK4B,UAKtBU,EAAQ,SAAC,GAIX,IAJ0D,iBAAP,GAAO,MAA7CC,aAA6C,aAA9BC,kBAA8B,SACtDC,GAAU,EACVC,EAAgB,KAChBC,EAAkB,EACtB,MAAgBC,OAAOT,KAAKE,GAA5B,eAAsC,CAAjC,IAAIrC,EAAG,KACJuC,GAASF,EAAQrC,GAAOgC,GACxBS,GAAU,EACVb,EAAM5B,IACCwC,IAAmC,IAApBG,GAAyBE,YAAYjC,MAAQyB,EAAQrC,MAC3EyC,GAAU,EACVC,EAAgB1C,EAChB2C,EAAkBN,EAAQrC,IAGlC,OAAOyC,GAAUb,EAAMc,MA5BnB3C,GACO2B,EAAQS,EAAKC,QAAQT,IAAIU,IAuDlCS,EAAO,SAACC,EAAKC,GACf,YADiD,IAAlCA,MAAYC,EAAId,EAAKT,aAChC3B,IAAWiD,KACXX,EAAQF,EAAKT,SAAWM,EAAMkB,SAASH,GAChCrB,EAAQS,EAAKC,QAAQT,IAAIU,KAKlCY,EAAM,SAACjD,GACT,OAAOsC,KAAWD,EAAQrC,IAAQqC,EAAQrC,IAAQgC,GAUtD,MAAO,CAAEL,IA5CG,SAACf,EAAOmC,GAChB,GAAIhD,EAAS,CACT,GAAIS,IAAUR,EAAK,CACf,IAAImD,EAASzB,EAAQS,EAAKT,SAASC,IAAIf,GAavC,OAZKuC,IACDb,IACAa,EAASzB,EAAQS,EAAKT,SAASC,IAAIf,IAElCuC,IACDb,EAAM,CAAEE,YAAY,IACpBW,EAASzB,EAAQS,EAAKT,SAASC,IAAIf,IAElCuC,IACDb,EAAM,CAAEC,OAAO,IACfY,EAASzB,EAAQS,EAAKT,SAASC,IAAIf,MAEhCuC,GAASL,EAAKC,GAAK,GAE1B,GAAIrC,EAAW,MAAMC,EAAUH,GAAOE,UAAU,iBAAkB,eAI1E,OAAO,GAsBGkB,QAAOqB,MAAKH,OAAMhB,IAPpB,SAACN,GACT,OAAIzB,GAAWkD,EAAId,EAAKT,SACbA,EAAQS,EAAKT,SAASI,IAAIN,GAE9BA,KAMf,MAAO,CACHzB,UACA4B,IAAK,SAAC3B,EAAYY,EAAcmC,GAA3B,gBAAC/C,MAAM,WAAP,IAAaY,MAAQ,WAArB,IAA2BmC,MAAMjD,GAAeiC,EAAW/B,GAAK2B,IAAIf,EAAOmC,IAChFnB,MAAO,SAAC5B,GAAD,gBAACA,MAAM,MAAS+B,EAAW/B,GAAK4B,SACvCqB,IAAK,SAACjD,GAAD,gBAACA,MAAM,MAAS+B,EAAW/B,GAAKiD,OACrCH,KAAM,SAAC9C,EAAY+C,GAAb,gBAAC/C,MAAM,WAAP,IAAa+C,MAAMjD,GAAeiC,EAAW/B,GAAK8C,KAAKC,IAC7DjB,IAAK,SAAC9B,EAAYwB,GAAb,gBAACxB,MAAM,WAAP,IAAawB,OAAW,GAAUO,EAAW/B,GAAK8B,IAAIN,IAC3De,MAAO,SAAC/B,GAAD,gBAACA,MAAQV,GAAiBiC,EAAWvB,GAAO8B,MAAM,CAAEC,OAAO,SCzKtEa,EAA2B,GCE/B,ODCA,SAASC,EAAoBC,GAE5B,GAAGF,EAAyBE,GAC3B,OAAOF,EAAyBE,GAAU9D,QAG3C,IAAIC,EAAS2D,EAAyBE,GAAY,CAGjD9D,QAAS,IAOV,OAHA+D,EAAoBD,GAAU7D,EAAQA,EAAOD,QAAS6D,GAG/C5D,EAAOD,QCjBR6D,CAAoB,K","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"stocache\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"stocache\"] = factory();\n\telse\n\t\troot[\"stocache\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn ","const config = {\r\n    scope: 'stocache',\r\n    ttl: 3600,\r\n    exception: false,\r\n    storageType: 'localStorage',\r\n}\r\n\r\nconst support = ((key) => {\r\n    try {\r\n        window[config.storageType].setItem(key, JSON.stringify(true))\r\n        return JSON.parse(window[config.storageType].getItem(key))\r\n    } catch (e) {\r\n        return false\r\n    }\r\n})(config.scope + '-' + 'support')\r\n\r\nconst Stocache = (scope = config.scope, storageType = config.storageType, exception = config.exception) => {\r\n    const generator = (scope) => ({\r\n        key: (value = scope) => {\r\n            let input = value === null ? scope : value\r\n            let code = 0\r\n            for (let i = 0; i < input.length; i++) {\r\n                code = (code << 5) - code + input.charCodeAt(i)\r\n                code = code & code\r\n            }\r\n            return scope + '-' + (code > 0 ? code : 'i' + Math.abs(code))\r\n        },\r\n        exception: (name = null, message = null) => ({\r\n            scope,\r\n            name,\r\n            message,\r\n        }),\r\n    })\r\n\r\n    const json = (value) => ({\r\n        encode: (fallback = '') => {\r\n            try {\r\n                return JSON.stringify(value)\r\n            } catch ({ message }) {\r\n                if (exception) throw generator(scope).exception('json.encode', message)\r\n                return fallback\r\n            }\r\n        },\r\n        decode: (fallback = {}) => {\r\n            try {\r\n                return JSON.parse(value)\r\n            } catch ({ message }) {\r\n                if (exception) throw generator(scope).exception('json.decode', message)\r\n                return fallback\r\n            }\r\n        },\r\n    })\r\n\r\n    const storage = (key = scope) => ({\r\n        set: (value = null) => {\r\n            try {\r\n                window[storageType].setItem(key, json(value).encode())\r\n                return true\r\n            } catch ({ message }) {\r\n                if (exception) throw generator(scope).exception('storage.set', message)\r\n                return false\r\n            }\r\n        },\r\n        unset: () => {\r\n            try {\r\n                window[storageType].removeItem(key)\r\n                return true\r\n            } catch ({ message }) {\r\n                if (exception) throw generator(scope).exception('storage.unset', message)\r\n                return false\r\n            }\r\n        },\r\n        get: (fallback = false) => {\r\n            return json(window[storageType].getItem(key)).decode(fallback)\r\n        },\r\n    })\r\n\r\n    const middleware = (key = scope, now = Math.floor(Date.now() / 1000)) => {\r\n        let keys = {\r\n            shadow: generator(scope).key(),\r\n            storage: generator(scope).key(key),\r\n        }\r\n        let context = storage(keys.shadow).get() || {}\r\n\r\n        const commit = () => {\r\n            if (support) {\r\n                return storage(keys.shadow).set(context)\r\n            }\r\n            return false\r\n        }\r\n\r\n        const unset = (key) => {\r\n            if (support) {\r\n                delete context[key]\r\n                return storage(key).unset()\r\n            }\r\n            return false\r\n        }\r\n\r\n        const clean = ({ flush = false, expireSoon = false } = {}) => {\r\n            let changed = false\r\n            let expireSoonKey = null\r\n            let expireSoonKTime = 0\r\n            for (let key of Object.keys(context)) {\r\n                if (flush || context[key] < now) {\r\n                    changed = true\r\n                    unset(key)\r\n                } else if (expireSoon && (expireSoonKTime === 0 || closestItem.value > context[key])) {\r\n                    changed = true\r\n                    expireSoonKey = key\r\n                    expireSoonKTime = context[key]\r\n                }\r\n            }\r\n            return changed ? unset(expireSoonKey) && commit() : true\r\n        }\r\n\r\n        const set = (value, ttl) => {\r\n            if (support) {\r\n                if (scope !== key) {\r\n                    let writed = storage(keys.storage).set(value)\r\n                    if (!writed) {\r\n                        clean()\r\n                        writed = storage(keys.storage).set(value)\r\n                    }\r\n                    if (!writed) {\r\n                        clean({ expireSoon: true })\r\n                        writed = storage(keys.storage).set(value)\r\n                    }\r\n                    if (!writed) {\r\n                        clean({ flush: true })\r\n                        writed = storage(keys.storage).set(value)\r\n                    }\r\n                    return writed ? keep(ttl, true) : false\r\n                } else {\r\n                    if (exception) throw generator(scope).exception('middleware.set', 'KeyConflict')\r\n                }\r\n            }\r\n\r\n            return false\r\n        }\r\n\r\n        const keep = (ttl, condition = has(keys.storage)) => {\r\n            if (support && condition) {\r\n                context[keys.storage] = now + parseInt(ttl)\r\n                return storage(keys.shadow).set(context)\r\n            }\r\n            return false\r\n        }\r\n\r\n        const has = (key) => {\r\n            return clean() && context[key] && context[key] >= now\r\n        }\r\n\r\n        const get = (fallback) => {\r\n            if (support && has(keys.storage)) {\r\n                return storage(keys.storage).get(fallback)\r\n            }\r\n            return fallback\r\n        }\r\n\r\n        return { set, unset, has, keep, get }\r\n    }\r\n\r\n    return {\r\n        support,\r\n        set: (key = null, value = null, ttl = config.ttl) => middleware(key).set(value, ttl),\r\n        unset: (key = null) => middleware(key).unset(),\r\n        has: (key = null) => middleware(key).has(),\r\n        keep: (key = null, ttl = config.ttl) => middleware(key).keep(ttl),\r\n        get: (key = null, fallback = false) => middleware(key).get(fallback),\r\n        flush: (scope = config.scope) => middleware(scope).clean({ flush: true }),\r\n    }\r\n}\r\n\r\nexport default Stocache\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(579);\n"],"sourceRoot":""}